# Prefect deployment configuration for local development
name: strava-analytics
prefect-version: 3.4.5

# Build configuration - no build steps needed for local deployment
build: null

# Push configuration - no push steps needed for local deployment
push: null

# Pull configuration - use local files, no Git operations
pull:
  - prefect.deployments.steps.set_working_directory:
      directory: "D:/ML projects/Portfolio/strava_analytics"

# Deployment definitions
deployments:
  # Token management - runs every hour
  - name: token-management-hourly
    entrypoint: src/strava_analytics/flows/token_management.py:proactive_token_management_flow
    schedule:
      cron: "0 * * * *"
      timezone: "UTC"
    description: "Proactive token management that refreshes tokens before they expire"
    tags: ["strava", "token-management", "automated"]
    parameters: {}
    work_pool:
      name: process-pool
      work_queue_name: default

  # Daily sync - runs every day at 6 AM Toronto time
  - name: daily-strava-sync
    entrypoint: src/strava_analytics/flows/main_pipeline.py:strava_analytics_pipeline_flow
    schedule:
      cron: "0 6 * * *"
      timezone: "America/Toronto"
    description: "Daily sync of recent Strava activities"
    tags: ["strava", "daily-sync", "automated"]
    parameters:
      max_pages: 5
    work_pool:
      name: process-pool
      work_queue_name: default

  # Weekly full sync - runs every Sunday at 7 AM Toronto time
  - name: weekly-strava-sync
    entrypoint: src/strava_analytics/flows/main_pipeline.py:strava_analytics_pipeline_flow
    schedule:
      cron: "0 7 * * 0"
      timezone: "America/Toronto"
    description: "Weekly full sync of all Strava activities"
    tags: ["strava", "weekly-sync", "automated"]
    parameters:
      max_pages: 100
    work_pool:
      name: process-pool
      work_queue_name: default

  # Manual full pipeline - no schedule, run on demand
  - name: manual-full-pipeline
    entrypoint: src/strava_analytics/flows/main_pipeline.py:strava_analytics_pipeline_flow
    description: "Manual execution of the full Strava analytics pipeline"
    tags: ["strava", "manual", "full-pipeline"]
    parameters:
      max_pages: 100
    work_pool:
      name: process-pool
      work_queue_name: default
